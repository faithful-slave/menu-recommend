<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜¤ëŠ˜ ë­ ë¨¹ì§€? Â· ë©€í‹° ì¶”ì²œ ëª¨ë“œ</title>
  <meta name="description" content="ê¸°ë³¸/í™˜ê²½ë°˜ì‘í˜•/ê°œì¸ë§ì¶¤í˜•/ì¬ë¯¸í˜•/ì‚¬íšŒì  ì¶”ì²œí˜•ì„ ì§€ì›í•˜ëŠ” ë©”ë‰´ ì¶”ì²œê¸°" />
  <style>
    :root{
      --bg: #f7f7fb; --card: #ffffff; --text: #1f2937; --muted: #6b7280; --primary: #ef4444; --primary-600:#dc2626; --ring: rgba(239,68,68,.25); --border: #e5e7eb; --chip: #f3f4f6; --shadow: 0 6px 18px rgba(0,0,0,.06); --radius: 16px;
    }
    @media (prefers-color-scheme: dark){:root{ --bg:#0b0f14; --card:#121821; --text:#e5e7eb; --muted:#9ca3af; --primary:#f87171; --primary-600:#ef4444; --ring:rgba(248,113,113,.25); --border:#1f2937; --chip:#111827; --shadow:0 10px 24px rgba(0,0,0,.35); }}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Arial;background:radial-gradient(1200px 600px at 80% -10%, rgba(239,68,68,.10), transparent 50%),radial-gradient(1200px 600px at 10% 110%, rgba(59,130,246,.10), transparent 50%),var(--bg);color:var(--text)}
    .wrap{max-width:1080px;margin:40px auto;padding:0 20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;background:#fff;box-shadow:var(--shadow)}
    h1{font-size:clamp(22px,3vw,28px);margin:0}
    .sub{color:var(--muted);font-size:14px}

    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 16px}
    .tab{padding:10px 14px;border-radius:999px;border:1px solid var(--border);background:var(--chip);cursor:pointer;font-weight:600}
    .tab[aria-selected="true"]{background:var(--primary);color:#fff;border-color:transparent}

    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
    .panel{padding:20px}

    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:800px){.grid.cols-3{grid-template-columns:repeat(3,1fr)}.grid.cols-4{grid-template-columns:repeat(4,1fr)}}

    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    select,input[type="range"],button{font-size:15px}
    select{width:100%;appearance:none;-webkit-appearance:none;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(var(--card),var(--card)) padding-box,linear-gradient(180deg,#fff0,#0000000d) border-box;color:var(--text);transition:box-shadow .2s,border-color .2s}
    select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px var(--ring)}

    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .btn{padding:12px 16px;border-radius:12px;border:1px solid transparent;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover{background:var(--primary-600)}
    .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--text)}

    .result{margin-top:18px;display:grid;gap:14px}
    .dish{display:flex;align-items:center;gap:16px;padding:16px;border:1px solid var(--border);border-radius:14px}
    .dish-emoji{width:56px;height:56px;border-radius:14px;display:grid;place-items:center;font-size:28px;background:var(--chip)}
    .dish-main{flex:1}
    .dish-name{font-size:18px;font-weight:800;letter-spacing:-.2px;margin:0 0 4px}
    .chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .chip{font-size:12px;padding:6px 10px;background:var(--chip);border-radius:999px;color:var(--muted);border:1px solid var(--border)}
    .muted{color:var(--muted);font-size:14px}

    footer{text-align:center;color:var(--muted);font-size:12px;padding:22px 0 40px}
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">ğŸ±</div>
        <div>
          <h1>ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</h1>
          <div class="sub">ê¸°ë³¸ Â· í™˜ê²½ë°˜ì‘í˜• Â· ê°œì¸ë§ì¶¤í˜• Â· ì¬ë¯¸í˜• Â· ì‚¬íšŒì  ì¶”ì²œí˜•</div>
        </div>
      </div>
      <button class="btn btn-ghost" id="btnExport" title="ë‚´ ì·¨í–¥/íˆ¬í‘œ ë°ì´í„° ë°±ì—…">ğŸ’¾ ë°±ì—…</button>
    </header>

    <nav class="tabs" role="tablist">
      <button class="tab" role="tab" aria-selected="true" data-tab="basic">ì¡°ê±´ ê¸°ë°˜ ì¶”ì²œí˜•</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="env">í™˜ê²½ ë°˜ì‘í˜•</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="learn">ê°œì¸ ë§ì¶¤í˜•</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="random">ëœë¤ ë„ì „í˜•</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="vote">ì‚¬íšŒì  ì¶”ì²œí˜•</button>
    </nav>

    <!-- BASIC: ì‹œê°„/ë§µê¸°/êµ­ê°€ -->
    <section class="card panel" id="panel-basic">
      <h2 class="visually-hidden">ì¡°ê±´ ê¸°ë°˜ ì¶”ì²œí˜•</h2>
      <div class="grid cols-3">
        <div>
          <label for="b-time">ì‹ì‚¬ ì‹œê°„ëŒ€</label>
          <select id="b-time"><option>ì•„ì¹¨</option><option selected>ì ì‹¬</option><option>ì €ë…</option><option>ì•¼ì‹</option><option>ê°„ì‹</option></select>
        </div>
        <div>
          <label for="b-spicy">ë§µê¸°</label>
          <select id="b-spicy"><option>0-ì•ˆë§¤ì›€</option><option selected>1-ì•½ê°„</option><option>2-ì¤‘ê°„</option><option>3-ë§¤ì›€</option></select>
        </div>
        <div>
          <label for="b-nation">êµ­ê°€ë³„</label>
          <select id="b-nation"><option selected>í•œì‹</option><option>ì¤‘ì‹</option><option>ì¼ì‹</option><option>ì–‘ì‹</option><option>ë™ë‚¨ì•„</option><option>ì¸ë„</option><option>ë©•ì‹œì½”</option><option>ê¸°íƒ€</option></select>
        </div>
      </div>
      <div class="actions"><button class="btn btn-primary" id="btnBasic">ì¶”ì²œë°›ê¸°</button><button class="btn btn-ghost" id="btnBasicReset">ì´ˆê¸°í™”</button></div>
      <div class="result" id="res-basic"><p class="muted">ì¡°ê±´ì„ ë°”ê¾¸ë©´ ìë™ìœ¼ë¡œ ì´ˆê¸°í™” í›„ ì¬ì¶”ì²œë©ë‹ˆë‹¤.</p></div>
    </section>

    <!-- ENV: ë‚ ì”¨/ê¸°ë¶„/ìš”ì¼ -->
    <section class="card panel" id="panel-env" hidden>
      <h2 class="visually-hidden">í™˜ê²½ ë°˜ì‘í˜•</h2>
      <div class="grid cols-3">
        <div><label for="e-weather">ë‚ ì”¨</label><select id="e-weather"><option selected>ë§‘ìŒ</option><option>íë¦¼</option><option>ë¹„</option><option>ëˆˆ</option><option>ìŠµí•¨</option><option>ì¶”ì›€</option><option>ë”ì›€</option></select></div>
        <div><label for="e-mood">ê¸°ë¶„</label><select id="e-mood"><option selected>ê¸°ë¶„ì¢‹ìŒ</option><option>í‰ë²”</option><option>í”¼ê³¤</option><option>ìš°ìš¸</option><option>ì¶•í•˜</option></select></div>
        <div><label for="e-dow">ìš”ì¼</label><select id="e-dow"><option>ì›”</option><option>í™”</option><option>ìˆ˜</option><option>ëª©</option><option>ê¸ˆ</option><option>í† </option><option>ì¼</option></select></div>
      </div>
      <div class="actions"><button class="btn btn-primary" id="btnEnv">ì¶”ì²œë°›ê¸°</button><button class="btn btn-ghost" id="btnEnvReset">ì´ˆê¸°í™”</button></div>
      <div class="result" id="res-env"><p class="muted">ë‚ ì”¨/ê¸°ë¶„/ìš”ì¼ ì¡°í•©ìœ¼ë¡œ ì–´ìš¸ë¦¬ëŠ” ë©”ë‰´ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.</p></div>
    </section>

    <!-- LEARN: ê°œì¸ ë§ì¶¤í˜• (ì¢‹ì•„ìš”/ì‹«ì–´ìš” í•™ìŠµ) -->
    <section class="card panel" id="panel-learn" hidden>
      <h2 class="visually-hidden">ê°œì¸ ë§ì¶¤í˜•</h2>
      <p class="muted">ì¢‹ì•„ìš”/ì‹«ì–´ìš”ë¡œ í•™ìŠµí•©ë‹ˆë‹¤. ë‹¤ìŒ ì¶”ì²œë¶€í„° ê°€ì¤‘ì¹˜ì— ë°˜ì˜ë¼ìš”.</p>
      <div class="actions"><button class="btn btn-primary" id="btnLearn">ì¶”ì²œë°›ê¸°</button><button class="btn btn-ghost" id="btnLearnReset">í•™ìŠµ ì´ˆê¸°í™”</button></div>
      <div class="result" id="res-learn"></div>
    </section>

    <!-- RANDOM: ë„ì „í˜• -->
    <section class="card panel" id="panel-random" hidden>
      <h2 class="visually-hidden">ëœë¤ ë„ì „í˜•</h2>
      <div class="grid cols-4">
        <div><label for="r-nation">êµ­ê°€ ì œì™¸</label><select id="r-nation" multiple size="4"><option>í•œì‹</option><option>ì¤‘ì‹</option><option>ì¼ì‹</option><option>ì–‘ì‹</option><option>ë™ë‚¨ì•„</option><option>ì¸ë„</option><option>ë©•ì‹œì½”</option><option>ê¸°íƒ€</option></select></div>
        <div><label for="r-spicy">ë§µê¸° ë²”ìœ„</label><select id="r-spicy"><option>ì „ì²´</option><option>0-ì•ˆë§¤ì›€</option><option>1-ì•½ê°„</option><option>2-ì¤‘ê°„</option><option>3-ë§¤ì›€</option></select></div>
        <div><label for="r-light">ê°€ë²¼ì›€</label><select id="r-light"><option>ì „ì²´</option><option>ë§¤ìš° ê°€ë²¼ì›€</option><option>ê°€ë²¼ì›€</option><option>ë³´í†µ</option><option>ë“ ë“ í•¨</option><option>í—¤ë¹„</option></select></div>
        <div><label>ë„ì „ ê°•ë„</label><input type="range" id="r-bold" min="0" max="3" value="1"/></div>
      </div>
      <div class="actions"><button class="btn btn-primary" id="btnRandom">ë„ì „!</button></div>
      <div class="result" id="res-random"></div>
    </section>

    <!-- VOTE: ì‚¬íšŒì  ì¶”ì²œí˜• (ë¡œì»¬ íˆ¬í‘œ) -->
    <section class="card panel" id="panel-vote" hidden>
      <h2 class="visually-hidden">ì‚¬íšŒì  ì¶”ì²œí˜•</h2>
      <p class="muted">ê°™ì´ ë³´ëŠ” ì‚¬ëŒë“¤ê³¼ íˆ¬í‘œí•´ ë³´ì„¸ìš”. ê²°ê³¼ëŠ” ì´ ë¸Œë¼ìš°ì €ì˜ ì €ì¥ê³µê°„ì—ë§Œ ê¸°ë¡ë©ë‹ˆë‹¤.</p>
      <div class="actions"><button class="btn btn-primary" id="btnVoteSeed">ëœë¤ í›„ë³´ 5ê°œ ìƒì„±</button><button class="btn btn-ghost" id="btnVoteReset">íˆ¬í‘œ ì´ˆê¸°í™”</button></div>
      <div class="result" id="res-vote"></div>
    </section>

    <footer>Made with â¤ Â· GitHub Pages</footer>
  </main>

  <script>
    // ====== ë°ì´í„°ì…‹ ======
    const MENUS = [
      // í•œì‹
      { name:'ë¹„ë¹”ë°¥', emoji:'ğŸ¥—', time:'ì ì‹¬', light:'ë³´í†µ', spicy:'1-ì•½ê°„', nation:'í•œì‹', type:'ë°¥' },
      { name:'ê¹€ì¹˜ì°Œê°œ', emoji:'ğŸ¥˜', time:'ì €ë…', light:'ë³´í†µ', spicy:'3-ë§¤ì›€', nation:'í•œì‹', type:'êµ­Â·íƒ•Â·ì°Œê°œ' },
      { name:'ëœì¥ì°Œê°œ', emoji:'ğŸ²', time:'ì €ë…', light:'ë³´í†µ', spicy:'0-ì•ˆë§¤ì›€', nation:'í•œì‹', type:'êµ­Â·íƒ•Â·ì°Œê°œ' },
      { name:'ì œìœ¡ë³¶ìŒ', emoji:'ğŸ–', time:'ì ì‹¬', light:'ë“ ë“ í•¨', spicy:'2-ì¤‘ê°„', nation:'í•œì‹', type:'ë°¥' },
      { name:'ê°ˆë¹„íƒ•', emoji:'ğŸ¥£', time:'ì €ë…', light:'ë“ ë“ í•¨', spicy:'0-ì•ˆë§¤ì›€', nation:'í•œì‹', type:'êµ­Â·íƒ•Â·ì°Œê°œ' },
      { name:'ê¹€ë°¥', emoji:'ğŸ™', time:'ì•„ì¹¨', light:'ê°€ë²¼ì›€', spicy:'0-ì•ˆë§¤ì›€', nation:'í•œì‹', type:'ë¶„ì‹' },
      { name:'ë–¡ë³¶ì´', emoji:'ğŸŒ¶ï¸', time:'ê°„ì‹', light:'ë³´í†µ', spicy:'2-ì¤‘ê°„', nation:'í•œì‹', type:'ë¶„ì‹' },
      { name:'ë¼ë©´', emoji:'ğŸœ', time:'ì•¼ì‹', light:'ë³´í†µ', spicy:'3-ë§¤ì›€', nation:'í•œì‹', type:'ë©´' },
      { name:'ë¬¼ëƒ‰ë©´', emoji:'ğŸ¥¶', time:'ì ì‹¬', light:'ê°€ë²¼ì›€', spicy:'0-ì•ˆë§¤ì›€', nation:'í•œì‹', type:'ë©´' },
      { name:'ë¹„ë¹”ëƒ‰ë©´', emoji:'ğŸ¥µ', time:'ì ì‹¬', light:'ê°€ë²¼ì›€', spicy:'2-ì¤‘ê°„', nation:'í•œì‹', type:'ë©´' },
      // ì¤‘ì‹
      { name:'ì§œì¥ë©´', emoji:'ğŸ', time:'ì ì‹¬', light:'ë³´í†µ', spicy:'0-ì•ˆë§¤ì›€', nation:'ì¤‘ì‹', type:'ë©´' },
      { name:'ì§¬ë½•', emoji:'ğŸ”¥', time:'ì ì‹¬', light:'ë³´í†µ', spicy:'3-ë§¤ì›€', nation:'ì¤‘ì‹', type:'ë©´' },
      { name:'ë§ˆíŒŒë‘ë¶€', emoji:'ğŸ²', time:'ì €ë…', light:'ê°€ë²¼ì›€', spicy:'2-ì¤‘ê°„', nation:'ì¤‘ì‹', type:'ê¸°íƒ€' },
      { name:'ê¿”ë°”ë¡œìš°', emoji:'ğŸ¥©', time:'ì €ë…', light:'í—¤ë¹„', spicy:'1-ì•½ê°„', nation:'ì¤‘ì‹', type:'ê¸°íƒ€' },
      // ì¼ì‹
      { name:'ì´ˆë°¥', emoji:'ğŸ£', time:'ì €ë…', light:'ë§¤ìš° ê°€ë²¼ì›€', spicy:'0-ì•ˆë§¤ì›€', nation:'ì¼ì‹', type:'ë°¥' },
      { name:'ëˆì¹´ì¸ ', emoji:'ğŸ±', time:'ì ì‹¬', light:'ë“ ë“ í•¨', spicy:'1-ì•½ê°„', nation:'ì¼ì‹', type:'ë°¥' },
      { name:'ìš°ë™', emoji:'ğŸ¥¢', time:'ì•„ì¹¨', light:'ê°€ë²¼ì›€', spicy:'0-ì•ˆë§¤ì›€', nation:'ì¼ì‹', type:'ë©´' },
      { name:'ê·œë™', emoji:'ğŸš', time:'ì €ë…', light:'ë³´í†µ', spicy:'0-ì•ˆë§¤ì›€', nation:'ì¼ì‹', type:'ë°¥' },
      // ì–‘ì‹
      { name:'ë§ˆë¥´ê²Œë¦¬íƒ€ í”¼ì', emoji:'ğŸ•', time:'ì €ë…', light:'ë³´í†µ', spicy:'0-ì•ˆë§¤ì›€', nation:'ì–‘ì‹', type:'ë¹µ/ë²„ê±°' },
      { name:'ë³¼ë¡œë„¤ì œ íŒŒìŠ¤íƒ€', emoji:'ğŸ', time:'ì €ë…', light:'ë³´í†µ', spicy:'0-ì•ˆë§¤ì›€', nation:'ì–‘ì‹', type:'ë©´' },
      { name:'ì¹˜ì¦ˆë²„ê±°', emoji:'ğŸ”', time:'ì ì‹¬', light:'í—¤ë¹„', spicy:'1-ì•½ê°„', nation:'ì–‘ì‹', type:'ë¹µ/ë²„ê±°' },
      { name:'ì‹œì €ìƒëŸ¬ë“œ', emoji:'ğŸ¥—', time:'ì•„ì¹¨', light:'ë§¤ìš° ê°€ë²¼ì›€', spicy:'0-ì•ˆë§¤ì›€', nation:'ì–‘ì‹', type:'ìƒëŸ¬ë“œ/ë¼ì´íŠ¸' },
      // ë™ë‚¨ì•„
      { name:'íŒŸíƒ€ì´', emoji:'ğŸ¤', time:'ì €ë…', light:'ë³´í†µ', spicy:'1-ì•½ê°„', nation:'ë™ë‚¨ì•„', type:'ë©´' },
      { name:'ìŒ€êµ­ìˆ˜', emoji:'ğŸœ', time:'ì ì‹¬', light:'ê°€ë²¼ì›€', spicy:'1-ì•½ê°„', nation:'ë™ë‚¨ì•„', type:'ë©´' },
      { name:'ë‚˜ì‹œê³ ë ', emoji:'ğŸš', time:'ì €ë…', light:'ë³´í†µ', spicy:'2-ì¤‘ê°„', nation:'ë™ë‚¨ì•„', type:'ë°¥' },
      // ì¸ë„
      { name:'ë²„í„°ì¹˜í‚¨ ì»¤ë¦¬', emoji:'ğŸ›', time:'ì €ë…', light:'ë³´í†µ', spicy:'1-ì•½ê°„', nation:'ì¸ë„', type:'ë°¥' },
      { name:'íŒ”ë½ íŒŒë‹ˆë¥´', emoji:'ğŸ¥¬', time:'ì ì‹¬', light:'ê°€ë²¼ì›€', spicy:'1-ì•½ê°„', nation:'ì¸ë„', type:'ë°¥' },
      { name:'ì¹˜í‚¨ í‹°ì¹´', emoji:'ğŸ—', time:'ì €ë…', light:'ë³´í†µ', spicy:'2-ì¤‘ê°„', nation:'ì¸ë„', type:'ìƒëŸ¬ë“œ/ë¼ì´íŠ¸' },
      // ë©•ì‹œì½”
      { name:'íƒ€ì½”', emoji:'ğŸŒ®', time:'ì ì‹¬', light:'ê°€ë²¼ì›€', spicy:'1-ì•½ê°„', nation:'ë©•ì‹œì½”', type:'ë¹µ/ë²„ê±°' },
      { name:'ë¶€ë¦¬ë˜', emoji:'ğŸŒ¯', time:'ì €ë…', light:'ë³´í†µ', spicy:'2-ì¤‘ê°„', nation:'ë©•ì‹œì½”', type:'ë¹µ/ë²„ê±°' },
      { name:'í€˜ì‚¬ë””ì•¼', emoji:'ğŸ«“', time:'ê°„ì‹', light:'ë³´í†µ', spicy:'1-ì•½ê°„', nation:'ë©•ì‹œì½”', type:'ë¹µ/ë²„ê±°' },
      // ê¸°íƒ€/ë¼ì´íŠ¸/ë””ì €íŠ¸
      { name:'ì—°ì–´í¬ì¼€', emoji:'ğŸŸ', time:'ì ì‹¬', light:'ë§¤ìš° ê°€ë²¼ì›€', spicy:'0-ì•ˆë§¤ì›€', nation:'ê¸°íƒ€', type:'ìƒëŸ¬ë“œ/ë¼ì´íŠ¸' },
      { name:'ìš”ê±°íŠ¸ ë³¼', emoji:'ğŸ¥£', time:'ì•„ì¹¨', light:'ë§¤ìš° ê°€ë²¼ì›€', spicy:'0-ì•ˆë§¤ì›€', nation:'ê¸°íƒ€', type:'ë””ì €íŠ¸' },
      { name:'í¬ë¡œí”Œ', emoji:'ğŸ§‡', time:'ê°„ì‹', light:'ë³´í†µ', spicy:'0-ì•ˆë§¤ì›€', nation:'ê¸°íƒ€', type:'ë””ì €íŠ¸' }
    ];

    // ====== ê³µí†µ ìœ í‹¸ ======
    const $ = s => document.querySelector(s);
    const $$ = s => [...document.querySelectorAll(s)];
    const pick = arr => arr[Math.floor(Math.random()*arr.length)];
    const chip = t => `<span class="chip">${t}</span>`;
    const renderDish = m => `
      <article class="dish" role="group" aria-label="ì¶”ì²œ ë©”ë‰´">
        <div class="dish-emoji" aria-hidden="true">${m.emoji||'ğŸ½ï¸'}</div>
        <div class="dish-main">
          <h3 class="dish-name">${m.name}</h3>
          <div class="chips">${chip(m.time)} ${chip(m.light)} ${chip(m.spicy)} ${chip(m.nation)} ${chip(m.type)}</div>
        </div>
        <button class="btn btn-ghost" aria-label="ë‹¤ì‹œ ì¶”ì²œ" onclick="reroll(this)">ğŸ”</button>
      </article>`;

    function reroll(btn){ // ê°™ì€ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì¬ì¶”ì²œ
      const panel = btn.closest('section');
      if(panel.id==='panel-basic') doBasic(true);
      else if(panel.id==='panel-env') doEnv(true);
      else if(panel.id==='panel-learn') doLearn(true);
      else if(panel.id==='panel-random') doRandom(true);
      else if(panel.id==='panel-vote') doVoteSeed(true);
    }

    // ====== íƒ­ ì „í™˜ ======
    $$('.tab').forEach(t=>t.addEventListener('click',()=>{
      $$('.tab').forEach(x=>x.setAttribute('aria-selected','false'));
      t.setAttribute('aria-selected','true');
      const key = t.dataset.tab;
      ['basic','env','learn','random','vote'].forEach(k=>$('#panel-'+k).hidden = k!==key);
    }));

    // ====== BASIC: ë³€ê²½ ì‹œ ì´ˆê¸°í™” í›„ ì¬ì ìš© ======
    const BASIC_DEFAULTS = { time:'ì ì‹¬', spicy:'1-ì•½ê°„', nation:'í•œì‹' };
    function basicSetDefaults(){ ['b-time','b-spicy','b-nation'].forEach((id)=>{
      const el = document.getElementById(id);
      const val = BASIC_DEFAULTS[id.replace('b-','')];
      const idx = [...el.options].findIndex(o=>o.value===val); if(idx>=0) el.selectedIndex = idx;
    }); }
    function doBasic(auto=false){
      const f = { time:$('#b-time').value, spicy:$('#b-spicy').value, nation:$('#b-nation').value };
      const group = MENUS.filter(m=>m.time===f.time && m.spicy===f.spicy && m.nation===f.nation);
      const candidates = group.length?group:MENUS.filter(m=>m.spicy===f.spicy && m.nation===f.nation);
      const chosen = pick(candidates.length?candidates:MENUS);
      $('#res-basic').innerHTML = renderDish(chosen);
      if(!auto) localStorage.setItem('basic', JSON.stringify(f));
    }
    ['b-time','b-spicy','b-nation'].forEach(id=>{
      document.getElementById(id).addEventListener('change', (e)=>{
        const val = e.target.value; basicSetDefaults();
        const el = e.target; const idx = [...el.options].findIndex(o=>o.value===val); if(idx>=0) el.selectedIndex=idx;
        doBasic(true);
      });
    });
    $('#btnBasic').addEventListener('click',()=>doBasic(false));
    $('#btnBasicReset').addEventListener('click',()=>{basicSetDefaults(); $('#res-basic').innerHTML='<p class="muted">ì¡°ê±´ì„ ë°”ê¾¸ë©´ ìë™ìœ¼ë¡œ ì´ˆê¸°í™” í›„ ì¬ì¶”ì²œë©ë‹ˆë‹¤.</p>';});

    // ====== ENV: ë‚ ì”¨/ê¸°ë¶„/ìš”ì¼ â†’ ê·œì¹™ ë§¤í•‘ ======
    function envRules(w,m,d){
      // ê°„ë‹¨í•œ ê·œì¹™ ìƒ˜í”Œ
      const rules = [];
      if(w==='ë¹„' || w==='ìŠµí•¨') rules.push(m=>m.spicy.startsWith('2')||m.spicy.startsWith('3')); // ë¹„/ìŠµí•¨ì—” ì–¼í°
      if(w==='ì¶”ì›€') rules.push(m=>m.type.includes('êµ­')||m.type==='ë©´' || m.spicy.startsWith('2'));
      if(w==='ë”ì›€') rules.push(m=>m.light.includes('ê°€ë²¼ì›€') || m.name.includes('ëƒ‰'));
      if(m==='í”¼ê³¤') rules.push(m=>m.light!=='í—¤ë¹„' && m.spicy!=='3-ë§¤ì›€');
      if(m==='ì¶•í•˜') rules.push(m=>['ì´ˆë°¥','í”¼ì','ë¶€ë¦¬ë˜','ëˆì¹´ì¸ '].includes(m.name));
      if(['í† ','ì¼'].includes(d)) rules.push(m=>m.time!=='ì•„ì¹¨');
      return rules;
    }
    function doEnv(auto=false){
      const w=$('#e-weather').value, mood=$('#e-mood').value, dow=$('#e-dow').value;
      const rules = envRules(w,mood,dow);
      let cands = MENUS.slice();
      rules.forEach(fn=> cands = cands.filter(fn));
      if(!cands.length) cands = MENUS; // fallback
      const chosen = pick(cands);
      $('#res-env').innerHTML = renderDish(chosen) + `<div class="muted">ê·œì¹™: ${rules.length||'ì—†ìŒ'}</div>`;
      if(!auto) localStorage.setItem('env', JSON.stringify({w,mood,dow}));
    }
    ['#e-weather','#e-mood','#e-dow'].forEach(sel=> $(sel).addEventListener('change', ()=>doEnv(true)) );
    $('#btnEnv').addEventListener('click',()=>doEnv(false));
    $('#btnEnvReset').addEventListener('click',()=>{$('#e-weather').selectedIndex=0;$('#e-mood').selectedIndex=0;$('#e-dow').selectedIndex=(new Date().getDay()+6)%7;$('#res-env').innerHTML='<p class="muted">ë‚ ì”¨/ê¸°ë¶„/ìš”ì¼ ì¡°í•©ìœ¼ë¡œ ì–´ìš¸ë¦¬ëŠ” ë©”ë‰´ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.</p>';});

    // ====== LEARN: ì¢‹ì•„ìš”/ì‹«ì–´ìš” ê°€ì¤‘ í•™ìŠµ ======
    const LIKE_KEY='likes-v1';
    function getLikes(){ return JSON.parse(localStorage.getItem(LIKE_KEY)||'{}'); }
    function setLikes(x){ localStorage.setItem(LIKE_KEY, JSON.stringify(x)); }
    function scoreLearn(m, likes){
      let s=0; // ê¸°ë³¸
      const w = likes[m.name]||0; s += w; // ê°œë³„ í•™ìŠµ
      // ì†ì„± ê°€ì¤‘ì¹˜(ì˜ˆ: nation-*, spicy-*)
      ['nation','spicy','time','light','type'].forEach(k=>{ const key = `${k}:${m[k]}`; s += (likes[key]||0)*0.5; });
      return s;
    }
    function doLearn(auto=false){
      const likes = getLikes();
      // softmax ë¹„ìŠ·í•œ ê°€ì¤‘ ëœë¤
      const weighted = MENUS.map(m=>({m, w: Math.exp(scoreLearn(m,likes))}));
      const sum = weighted.reduce((a,b)=>a+b.w,0);
      let r = Math.random()*sum; let chosen = weighted[0].m;
      for(const {m,w} of weighted){ r -= w; if(r<=0){ chosen=m; break; } }
      $('#res-learn').innerHTML = renderDish(chosen) + `<div class="actions"><button class="btn btn-primary" id="btnLike">ğŸ‘ ì¢‹ì•„ìš”</button><button class="btn btn-ghost" id="btnDislike">ğŸ‘ ì‹«ì–´ìš”</button></div>`;
      if(!auto) localStorage.setItem('learn-last', chosen.name);
      // ë²„íŠ¼ í•¸ë“¤ëŸ¬
      setTimeout(()=>{
        const name = chosen.name;
        $('#btnLike')?.addEventListener('click',()=>{ const L=getLikes(); L[name]=(L[name]||0)+1; ['nation','spicy','time','light','type'].forEach(k=>{const key=`${k}:${chosen[k]}`; L[key]=(L[key]||0)+0.5;}); setLikes(L); doLearn(true); });
        $('#btnDislike')?.addEventListener('click',()=>{ const L=getLikes(); L[name]=(L[name]||0)-1; ['nation','spicy','time','light','type'].forEach(k=>{const key=`${k}:${chosen[k]}`; L[key]=(L[key]||0)-0.3;}); setLikes(L); doLearn(true); });
      },0);
    }
    $('#btnLearn').addEventListener('click',()=>doLearn(false));
    $('#btnLearnReset').addEventListener('click',()=>{ localStorage.removeItem(LIKE_KEY); localStorage.removeItem('learn-last'); $('#res-learn').innerHTML=''; });

    // ====== RANDOM: ë„ì „í˜• ======
    function doRandom(auto=false){
      const ex = $$('#r-nation option:checked').map(o=>o.value);
      const spicy = $('#r-spicy').value; const light=$('#r-light').value; const bold=+$('#r-bold').value; // 0~3
      let cands = MENUS.filter(m=>!ex.includes(m.nation));
      if(spicy!=='ì „ì²´') cands = cands.filter(m=>m.spicy===spicy);
      if(light!=='ì „ì²´') cands = cands.filter(m=>m.light===light);
      // ë„ì „ ê°•ë„: í‰ì†Œ ì„ íƒ ì ì€ nation/type ìš°ì„ 
      const freq = JSON.parse(localStorage.getItem('random-freq')||'{}');
      cands = cands.sort((a,b)=> ( (freq[a.nation]||0)-(freq[b.nation]||0) ) * bold + Math.random()-0.5);
      const chosen = pick(cands.length?cands:MENUS);
      freq[chosen.nation]=(freq[chosen.nation]||0)+1; localStorage.setItem('random-freq', JSON.stringify(freq));
      $('#res-random').innerHTML = renderDish(chosen) + `<div class="muted">ë„ì „ ê°•ë„: ${bold} Â· ì œì™¸êµ­ê°€: ${ex.join(',')||'ì—†ìŒ'}</div>`;
      if(!auto) localStorage.setItem('random-last', chosen.name);
    }
    $('#btnRandom').addEventListener('click',()=>doRandom(false));

    // ====== VOTE: ì‚¬íšŒì  ì¶”ì²œí˜• ======
    const VOTE_KEY='votes-v1';
    function getVotes(){ return JSON.parse(localStorage.getItem(VOTE_KEY)||'{}'); }
    function setVotes(x){ localStorage.setItem(VOTE_KEY, JSON.stringify(x)); }
    function renderVoteBoard(items){
      const votes = getVotes();
      const list = items.map(n=>({ n, c: votes[n]||0 })).sort((a,b)=>b.c-a.c);
      return list.map(({n,c})=>`<div class="dish"><div class="dish-emoji">${(MENUS.find(m=>m.name===n)||{}).emoji||'ğŸ½ï¸'}</div><div class="dish-main"><div class="dish-name">${n}</div><div class="muted">ë“í‘œ: ${c}</div></div><div class="actions"><button class="btn btn-primary" data-vote="${n}">íˆ¬í‘œ</button></div></div>`).join('');
    }
    function doVoteSeed(auto=false){
      // í›„ë³´ 5ê°œ ëœë¤ ìƒì„± (ì¤‘ë³µ ì—†ì´)
      const pool = MENUS.slice();
      const picks = [];
      while(picks.length<5 && pool.length){ const idx=Math.floor(Math.random()*pool.length); picks.push(pool.splice(idx,1)[0].name); }
      $('#res-vote').innerHTML = renderVoteBoard(picks);
      setTimeout(()=>{
        $$('#res-vote [data-vote]').forEach(btn=> btn.addEventListener('click',()=>{ const v=getVotes(); const key=btn.dataset.vote; v[key]=(v[key]||0)+1; setVotes(v); // ê°±ì‹ 
          const names = $$('#res-vote [data-vote]').map(b=>b.dataset.vote); $('#res-vote').innerHTML = renderVoteBoard(names);
        }));
      },0);
      if(!auto) localStorage.setItem('vote-cands', JSON.stringify(picks));
    }
    $('#btnVoteSeed').addEventListener('click',()=>doVoteSeed(false));
    $('#btnVoteReset').addEventListener('click',()=>{ localStorage.removeItem(VOTE_KEY); localStorage.removeItem('vote-cands'); $('#res-vote').innerHTML=''; });

    // ====== ë°ì´í„° ë°±ì—…(ë‚´ë³´ë‚´ê¸°) ======
    $('#btnExport').addEventListener('click',()=>{
      const data = {
        likes: getLikes(), votes: getVotes(), random: JSON.parse(localStorage.getItem('random-freq')||'{}')
      };
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'food-preferences-backup.json'; a.click();
    });

    // ====== ì´ˆê¸°í™” ======
    (function init(){
      // ê¸°ë³¸ íƒ­ ìƒíƒœ
      const dow = (new Date().getDay()+6)%7; $('#e-dow').selectedIndex = dow; // ì›”=0
      // ê¸°ë³¸ì¡°ê±´ ë³µì›
      const bSaved = JSON.parse(localStorage.getItem('basic')||'null');
      if(bSaved){ ['time','spicy','nation'].forEach(k=>{ const el=$('#b-'+k); const idx=[...el.options].findIndex(o=>o.value===bSaved[k]); if(idx>=0) el.selectedIndex=idx; }); }
    })();
  </script>
</body>
</html>
