<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì˜¤ëŠ˜ ë­ ë¨¹ì§€ Â· ì‹¤ì‹œê°„(ì˜¤ëŠ˜ ë°©ë¬¸ + íˆ¬í‘œ)</title>
  <style>
    body{font-family:system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', Arial;
         margin:40px auto; max-width:900px; padding:0 16px; line-height:1.6}
    h1{margin:0 0 8px}
    .card{border:1px solid #e5e7eb; border-radius:14px; padding:16px; margin:14px 0}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    button{padding:8px 12px; border-radius:10px; border:1px solid #e5e7eb; cursor:pointer}
    .muted{color:#6b7280}
    .pill{display:inline-block; padding:4px 10px; border:1px solid #e5e7eb; border-radius:999px; margin-right:6px}
  </style>

  <!-- Firebase CDN (npm ì•ˆ ì“°ëŠ” ìˆœìˆ˜ HTMLìš©) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>
</head>
<body>
  <h1>ğŸ± ì˜¤ëŠ˜ ë­ ë¨¹ì§€</h1>
  <p class="muted">ê¹ƒí—ˆë¸Œ í˜ì´ì§€ + Firebase Realtime DB (ì˜¤ëŠ˜ ëˆ„ì  ì ‘ì†ì Â· íˆ¬í‘œ ë™ê¸°í™”)</p>

  <div class="card">
    <h2>ğŸ“ˆ ì˜¤ëŠ˜ ëˆ„ì  ì ‘ì†ì</h2>
    <div>ì˜¤ëŠ˜(Asia/Seoul) ë°©ë¬¸ ìˆ˜: <strong id="todayCount">0</strong> ëª…</div>
  </div>

  <div class="card">
    <h2>ğŸ—³ï¸ íˆ¬í‘œ</h2>
    <div id="voteButtons" class="row"></div>
    <div style="margin-top:10px" id="voteResults" class="muted">ë¡œë“œ ì¤‘â€¦</div>
  </div>

  <script>
    // 1) ì—¬ê¸°ë§Œ ë³¸ì¸ í”„ë¡œì íŠ¸ ê°’ìœ¼ë¡œ êµì²´ (Firebase ì½˜ì†” â†’ ì›¹ì•± ì¶”ê°€ì—ì„œ ì œê³µ)
    const firebaseConfig = {
      apiKey: "AIzaSyExample-abcdefg1234567890",
      authDomain: "menu-app.firebaseapp.com",
      databaseURL: "https://menu-app-default-rtdb.firebaseio.com",
      projectId: "menu-app",
      storageBucket: "menu-app.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcdef123456"
    };

    // 2) íˆ¬í‘œ í•­ëª© ì •ì˜ (ì›í•˜ëŠ” ë©”ë‰´ë¡œ ë°”ê¾¸ì„¸ìš”)
    const VOTE_OPTIONS = ["ë¹„ë¹”ë°¥", "ë¼ë©´", "ê¹€ì¹˜ì°Œê°œ", "íŒŒìŠ¤íƒ€", "ì´ˆë°¥"];

    // --- Firebase ì´ˆê¸°í™” ---
    const app = firebase.initializeApp(firebaseConfig);
    const db  = firebase.database();

    // --- ìœ í‹¸: ì˜¤ëŠ˜ ë‚ ì§œ(Asia/Seoul) YYYY-MM-DD ---
    function todayKR() {
      const now = new Date();
      const formatter = new Intl.DateTimeFormat("ko-KR", {
        timeZone: "Asia/Seoul",
        year: "numeric", month: "2-digit", day: "2-digit"
      });
      const [{value:y},{value:sep1},{value:m},{value:sep2},{value:d}] = formatter.formatToParts(now);
      // ko-KRëŠ” ë³´í†µ 2025. 11. 03. í˜•ì‹ â†’ ì•ˆì „í•˜ê²Œ 0íŒ¨ë”© ì •ê·œí™”
      const yy = y.padStart(4,"0");
      const mm = m.padStart(2,"0").replace(/\D/g,"");
      const dd = d.padStart(2,"0").replace(/\D/g,"");
      return `${yy}-${mm}-${dd}`;
    }

    // =========================
    // A) ì˜¤ëŠ˜ ëˆ„ì  ì ‘ì†ì (ì¤‘ë³µ ë°©ì§€)
    // =========================
    (function trackTodayVisits(){
      const key = "visited-"+todayKR();
      if (!sessionStorage.getItem(key)) {
        sessionStorage.setItem(key, "1"); // ìƒˆ íƒ­/ìƒˆ ì„¸ì…˜ë‹¹ 1íšŒë§Œ ì¹´ìš´íŠ¸
        const ref = db.ref("stats/" + todayKR() + "/visits");
        // íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì›ìì  ì¦ê°€
        ref.transaction(current => (current || 0) + 1);
      }
      // ì‹¤ì‹œê°„ í‘œì‹œ
      const countRef = db.ref("stats/" + todayKR() + "/visits");
      countRef.on("value", snap => {
        document.getElementById("todayCount").textContent = snap.val() || 0;
      });
    })();

    // =========================
    // B) íˆ¬í‘œ ë™ê¸°í™”
    // ê²½ë¡œ: votes/<ì˜µì…˜ëª…>: count
    // =========================
    const voteButtonsEl = document.getElementById("voteButtons");
    const voteResultsEl = document.getElementById("voteResults");

    // ë²„íŠ¼ ìƒì„±
    VOTE_OPTIONS.forEach(name => {
      const btn = document.createElement("button");
      btn.textContent = "íˆ¬í‘œ: " + name;
      btn.addEventListener("click", () => {
        const ref = db.ref("votes/" + name + "/count");
        ref.transaction(current => (current || 0) + 1);
      });
      voteButtonsEl.appendChild(btn);
    });

    // ì‹¤ì‹œê°„ ê²°ê³¼ í‘œì‹œ
    const votesRef = db.ref("votes");
    votesRef.on("value", snap => {
      const data = snap.val() || {};
      // ì •ë ¬(ë“í‘œ ë†’ì€ ìˆœ)
      const items = Object.entries(data)
        .map(([name, obj]) => ({ name, count: (obj && obj.count) || 0 }))
        .sort((a,b) => b.count - a.count);
      voteResultsEl.innerHTML = items.length
        ? items.map(v => `<span class="pill">${v.name}: ${v.count}</span>`).join(" ")
        : "ì•„ì§ íˆ¬í‘œ ì—†ìŒ";
    });
  </script>
</body>
</html>
